<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Magpie, PHP 4.3.2 Memory Error, an Update | Kellan Elliott-McCrea: Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Magpie, PHP 4.3.2 Memory Error, an Update" />
<meta name="author" content="Kellan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Steve tracked down the root of the problem that is causing MagpieRSS to run out of memory after upgrading to 4.3.2. It lies in my (apparently dodgy) patch to Snoopy to add gzip support." />
<meta property="og:description" content="Steve tracked down the root of the problem that is causing MagpieRSS to run out of memory after upgrading to 4.3.2. It lies in my (apparently dodgy) patch to Snoopy to add gzip support." />
<link rel="canonical" href="https://laughingmeme.org/2003/06/25/magpie-php-432-memory-error-an-update/" />
<meta property="og:url" content="https://laughingmeme.org/2003/06/25/magpie-php-432-memory-error-an-update/" />
<meta property="og:site_name" content="Kellan Elliott-McCrea: Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2003-06-25T12:49:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Magpie, PHP 4.3.2 Memory Error, an Update" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kellan"},"dateModified":"2003-06-25T12:49:00+00:00","datePublished":"2003-06-25T12:49:00+00:00","description":"Steve tracked down the root of the problem that is causing MagpieRSS to run out of memory after upgrading to 4.3.2. It lies in my (apparently dodgy) patch to Snoopy to add gzip support.","headline":"Magpie, PHP 4.3.2 Memory Error, an Update","mainEntityOfPage":{"@type":"WebPage","@id":"https://laughingmeme.org/2003/06/25/magpie-php-432-memory-error-an-update/"},"url":"https://laughingmeme.org/2003/06/25/magpie-php-432-memory-error-an-update/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://laughingmeme.org/feed.xml" title="Kellan Elliott-McCrea: Blog" /><style>
    .post-date {
      float: right;
    }
  </style>
  <script defer data-domain="laughingmeme.org" src="https://plausible.io/js/script.js"></script>

</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Kellan Elliott-McCrea: Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="https://kellanem.com/notes/">Leadership notes</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Magpie, PHP 4.3.2 Memory Error, an Update</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2003-06-25T12:49:00+00:00" itemprop="datePublished">Jun 25, 2003
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Kellan</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="http://minutillo.com/steve/weblog/">Steve</a> tracked down the root of the problem that is causing MagpieRSS to run out of memory after upgrading to 4.3.2. It lies in my (apparently dodgy) patch to Snoopy to add gzip support.</p>

<h3 id="temporary-solution">Temporary Solution</h3>

<p>To turn off gzip encoding (and thereby avoid this bug) add:  <code class="language-plaintext highlighter-rouge">define('MAGPIE&lt;em&gt;USE&lt;/em&gt;GZIP', false);</code></p>

<p>to the top of your script. ### Explanation</p>

<p>After much hair pulling trying to get gzip encoding working in PHP, I found this magic recipe in <a href=" http://www.php.net/manual/en/function.gzencode.php">comments attached to gzencode</a>: ` $results = substr($results, 10); $results = gzinflate($results);`</p>

<p>Seems you had to strip off the gzip header to make it work. This was confirmed when I found <a href="http://simon.incutio.com/">Simon’s</a> <a href="http://scripts.incutio.com/httpclient/">httpClient</a>. Apparently this is changed in 4.3.2, and stripping the first 10 characters leads eventually (through a yet untraced path) to an out of memory error.</p>

<h3 id="next-steps">Next Steps</h3>

<p>Does anyone have any info about this? Any suggestions on a good way to support 4.3.2 and pre-4.3.2 PHPs? Gzip encoding really isn’t an optional feature in a modern aggregator, so turning it off is a short term solution. ### Update 6/25 2:16</p>

<p>Okay, so I’ve got PHP 4.2.3 locally now (via <a href="http://www.entropy.ch/software/macosx/php/">Marc Liyanage’s excellent package</a>), and I’m seeing similar behaviour. I don’t actually get an out of memory error, but I can see memory usage spike (with iPulse) and I get a warning about a gzinflate buffer error. Unforunately removing “$results = substr($results, 10);” <strong>does not</strong> fix the problem for me. So currently the only solution is to turn gzip encoding off <img src="http://lm.local/wp-includes/images/smilies/frownie.png" alt=":(" />### Curiouser and Curiouser</p>

<p>So removing the substr() call changed the error message form “gzinflate(): buffer error”, to “gzinflate(): data error”. However only for certain websites! Files served with gzip encoding from some sites (<a href="http://dev.protest.net/~kellan/cvs-rss/">like mine</a>) work, but from others, it doesn’t. Ack.</p>

  </div><a class="u-url" href="/2003/06/25/magpie-php-432-memory-error-an-update/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">


    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Kellan Elliott-McCrea</li><li><a class="u-email" href="mailto:kellan@gmail.com">kellan@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list">
  <li>On Mastodon: <a href="https://fiasco.social/@kellan">@kellan</a></li><li><a href="https://www.twitter.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.flickr.com/photos/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#flickr"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://github.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.linkedin.com/in/kellanem"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">kellanem</span></a></li><li><a href="https://kellanem.com/notes/">Leadership blog</a></li>
</ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A personal blog of Kellan Elliott-McCrea. I don&#39;t really know what a &quot;laughing meme&quot; is. It sounded cool in 1999.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
