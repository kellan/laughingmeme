<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>App Logic with PEAR Errors | Kellan Elliott-McCrea: Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="App Logic with PEAR Errors" />
<meta name="author" content="Kellan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A quick thought which I need to explore some more, but I thought I’d write it down. (it is worrying when you can’t sleep for thoughts of PHP authentication, front controllers, and PEAR error handlers)" />
<meta property="og:description" content="A quick thought which I need to explore some more, but I thought I’d write it down. (it is worrying when you can’t sleep for thoughts of PHP authentication, front controllers, and PEAR error handlers)" />
<link rel="canonical" href="https://laughingmeme.org/2004/02/02/app-logic-with-pear-errors/" />
<meta property="og:url" content="https://laughingmeme.org/2004/02/02/app-logic-with-pear-errors/" />
<meta property="og:site_name" content="Kellan Elliott-McCrea: Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2004-02-02T00:07:28+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="App Logic with PEAR Errors" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kellan"},"dateModified":"2004-02-02T00:07:28+00:00","datePublished":"2004-02-02T00:07:28+00:00","description":"A quick thought which I need to explore some more, but I thought I’d write it down. (it is worrying when you can’t sleep for thoughts of PHP authentication, front controllers, and PEAR error handlers)","headline":"App Logic with PEAR Errors","mainEntityOfPage":{"@type":"WebPage","@id":"https://laughingmeme.org/2004/02/02/app-logic-with-pear-errors/"},"url":"https://laughingmeme.org/2004/02/02/app-logic-with-pear-errors/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://laughingmeme.org/feed.xml" title="Kellan Elliott-McCrea: Blog" /><style>
    .post-date {
      float: right;
    }
  </style>
  <script defer data-domain="laughingmeme.org" src="https://plausible.io/js/script.js"></script>

</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Kellan Elliott-McCrea: Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="https://kellanem.com/notes/">Leadership notes</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">App Logic with PEAR Errors</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2004-02-02T00:07:28+00:00" itemprop="datePublished">Feb 2, 2004
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Kellan</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>A quick thought which I need to explore some more, but I thought I’d write it down. (it is worrying when you can’t sleep for thoughts of PHP authentication, front controllers, and PEAR error handlers)</p>

<p>All of the examples of custom PEAR error handlers I’ve ever see (of which <a href="http://www.asiatica.org/~ludo/archive/2003/08/PHP_ErrorHandling.html">Ludoo’s is the clearest</a>) all show using them for a better pretty print. Some talk about having them do logging, or fire off an email. But is anyone using them to implement application logic?</p>

<p><a href="http://www.martinfowler.com/eaaCatalog/frontController.html">Front controllers</a> are a lovely design pattern for web apps, but a number of people have argued they <a href="http://phppatterns.com/index.php/article/articleview/81/1/1/">aren’t suited to PHP</a> (and PHP is not suited to them). Which is a shame, because they’re really useful for a number of task. One of those is enforcing proper credentials, and dealing with authentication/authorization failures intelligently.</p>

<p>Seems like you could get the intelligent dispatching aspect of a front controller, without having to front load your authorization knowledge or give up your page centric development model.</p>

<p>At the beginning of your script you have some check like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
$user = $auth-&gt;valid_user();
if (not $user) {
   $this-&gt;throwError('Unknown user', AUTH_FAILURE_UNKNOWN, array( 'referer' =&gt; 'my_script.php') );
}
elseif (not $user-&gt;can_do_foo() ) {
   $this-&gt;throwError("I'm sorry but you don't have permission to foo", AUTH_FAILURE_INSUFFICIENT_PERMS );
}
</code></pre></div></div>

<p>… meanwhile over in auth.php</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
define('AUTH&lt;em&gt;FAILURE&lt;/em&gt;UNKNOWN', 1001);
define('AUTH&lt;em&gt;FAILURE&lt;/em&gt;INSUFFICIENT&lt;em&gt;PERMS', 1002);
...
function valid&lt;/em&gt;user {
...check cookies, session vars, whatever....
}
</code></pre></div></div>

<p>… and then the error handler does something like … ```</p>

<p>function errorHandler($err) {
   if ( $err-&gt;getCode == AUTH_FAILURE_UNKNOWN ) {
    … take user to login page, 
        …. then send them back to attempted action using ‘referer’ var
   }
   elseif ( $err-&gt;getCode == AUTH_FAILURE_INSUFFICIENT_PERMS ) {
        … maybe take them to a warning page?
         … or merely return the error for inline display
   }
   else {
     return, print, die, whatever works for your app
   }
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Did you notice the hand waving? (“Its all hand waving Kellan!”, yes but some it more then most) How do we “take the user” somewhere? And ensure that the proper flow of the app is maintained? After all these aren’t real exceptions, flow isn’t going to terminate here. There are two solutions.

If you’ve been good, I mean **really** good, and you know that you haven’t sent any data back to the user yet (this includes blank lines that somehow got sucked in by your cascading includes) then you can use header(“Location: $login*page”) to redirect the user. An example of when you might have been this good is when you’ve mandated that all content is generated by template files, after all the logic has completed, and even then.*

Another option which I just realized tonight, which got me started writing all this, and is of course obvious, but I hadn’t thought of it is to simple do something like

</code></pre></div></div>

<p>elseif ( $err-&gt;getCode == AUTHFAILURE<em>INSUFFICIENT</em>PERMS ) {
   include(‘you-dont-have-that-kind-access.php’);
   exit;
}
```</p>

<p>I tend to think of PHP’s exit, which a synonym for die() in terms of Perl’s die, which is used to flag untoward circumstances, but in fact PHP apps can exit without it being an indication of anything the matter. You can argue that all this error handling, and indirection increase the “magic factor” of your script, but for my money I think this would be a huge win in terms of readability, and centralization of logic without requiring one to buy into to an entire MVC framework.</p>

  </div><a class="u-url" href="/2004/02/02/app-logic-with-pear-errors/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">


    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Kellan Elliott-McCrea</li><li><a class="u-email" href="mailto:kellan@gmail.com">kellan@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list">
  <li>On Mastodon: <a href="https://fiasco.social/@kellan">@kellan</a></li><li><a href="https://www.twitter.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.flickr.com/photos/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#flickr"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://github.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.linkedin.com/in/kellanem"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">kellanem</span></a></li><li><a href="https://kellanem.com/notes/">Leadership blog</a></li>
</ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A personal blog of Kellan Elliott-McCrea. I don&#39;t really know what a &quot;laughing meme&quot; is. It sounded cool in 1999.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
