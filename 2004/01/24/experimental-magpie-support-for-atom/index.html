<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Experimental Magpie Support for Atom | Kellan Elliott-McCrea: Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Experimental Magpie Support for Atom" />
<meta name="author" content="Kellan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="You are officially entering wet cat territory." />
<meta property="og:description" content="You are officially entering wet cat territory." />
<link rel="canonical" href="https://laughingmeme.org/2004/01/24/experimental-magpie-support-for-atom/" />
<meta property="og:url" content="https://laughingmeme.org/2004/01/24/experimental-magpie-support-for-atom/" />
<meta property="og:site_name" content="Kellan Elliott-McCrea: Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2004-01-24T03:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Experimental Magpie Support for Atom" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kellan"},"dateModified":"2004-01-24T03:00:00+00:00","datePublished":"2004-01-24T03:00:00+00:00","description":"You are officially entering wet cat territory.","headline":"Experimental Magpie Support for Atom","mainEntityOfPage":{"@type":"WebPage","@id":"https://laughingmeme.org/2004/01/24/experimental-magpie-support-for-atom/"},"url":"https://laughingmeme.org/2004/01/24/experimental-magpie-support-for-atom/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://laughingmeme.org/feed.xml" title="Kellan Elliott-McCrea: Blog" /><style>
    .post-date {
      float: right;
    }
  </style>
  <script defer data-domain="laughingmeme.org" src="https://plausible.io/js/script.js"></script>

</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Kellan Elliott-McCrea: Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="https://kellanem.com/notes/">Leadership notes</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Experimental Magpie Support for Atom</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2004-01-24T03:00:00+00:00" itemprop="datePublished">Jan 24, 2004
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Kellan</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>You are officially entering <a href="http://laughingmeme.org/archives/000918.html#000918">wet cat territory.</a></p>

<p>Inspired by <a href="http://www.papascott.de/2004/01/03/2785.php">Scott’s patch</a>, the <a href="http://new.blogger.com/news_archive.pyra?which=2004_01_01_archive.html#107482061490785955">million or so sites that only produce Atom</a>, and a couple of requests, I hacked experimental support for parsing <a href="http://www.intertwingly.net/wiki/pie/FrontPage">Atom</a> into <a href="http://magpierss.sf.net">Magpie</a>.</p>

<p>Taking a page from <a href="http://diveintomark.org">Mark’s</a> <a href="http://diveintomark.org/projects/feed_parser/">Feed Parser</a>, it should be relatively transparent to move between parsing an RSS feed, and parsing an Atom feed. Specifically</p>

<ul>
  <li>Atom feed elements and RSS channel elements are both accessible via <code class="language-plaintext highlighter-rouge">$feed-&gt;channel[$element&lt;em&gt;name]&lt;/em&gt;</code>.</li>
  <li>Atom link elements that point to an alternative html version (i.e. those with the attribute <code class="language-plaintext highlighter-rouge">rel="alternative"</code>) are treated as being equivalent to RSS’s link elements and are accessible via <code class="language-plaintext highlighter-rouge">$feed-&gt;channel['link']</code> and <code class="language-plaintext highlighter-rouge">$item['link']</code></li>
  <li>channel/description is mapped to channel/tagline and channel/tagline is mapped to channel/description</li>
  <li>item/description is mapped to item/summary and item/summary is mapped to item/description</li>
</ul>

<h3 id="namespaces-and-atoms-itemcontent-field">Namespaces and Atom’s item/content field</h3>

<p>Magpie handles namespaces by adding an array to an item using the namespace prefix as the key. For example and item’s &lt;dc:subject&gt; (aka item/dc/subject) field is available at <code class="language-plaintext highlighter-rouge">$item['dc']['subject']</code>. This has never been ideal, but it is simple, from both the parser’s and the user’s perspective. This causes a small conflict between RSS’s item/content/encoded field and Atom’s item/content field. I’ve chosen to make Atom’s item/content field available at <code class="language-plaintext highlighter-rouge">$item['atomcontent']</code>. If the content field is of type xml, I flatten it to string instead of making the parse tree available. (I don’t think anyone using Magpie wants the parse tree). Like I said, wet cat country. Also, item/content/encoded and item/atom_encoded are mapped to each other. ### Nested Elements</p>

<p>Magpie has never handled elements nested more then one level deep. While this could have potentially been a problem while parsing RSS, no one has mentioned it yet. However Atom even at its simplest has a number of nested elements, so just ignoring them wasn’t going to work. Here is what I do, this: ```</p>

<author>
    <name>Mark Pilgrim</name>
    <url>http://diveintomark.org/</url>
    <email>f8dy@diveintomark.org</email>
  </author>

<p></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Becomes: ```

[author&lt;em&gt;name] =&gt; Mark Pilgrim
[author&lt;/em&gt;url] =&gt; http://diveintomark.org/
[author_email] =&gt; f8dy@diveintomark.org
</code></pre></div></div>

<p>Lastly there are two new methods <code class="language-plaintext highlighter-rouge">$feed-&gt;is&lt;em&gt;rss()&lt;/em&gt;</code> and <code class="language-plaintext highlighter-rouge">$rss-&gt;isatom()</code> which return false when false, and return the version number of the feed when true (e.g. for Atom will likely return ‘0.3’, for RSS could return ‘1.0’, ‘2.0’, ‘0.91’, ‘0.93b71’, or a variety of other values)</p>

<h3 id="getting-started">Getting Started.</h3>

<p>I think that is everything you need to know to get started playing. I’ll do a release complete with tarball once Sourceforge’s CVS servers are back online, in the meantime you can download <a href="/rss_parse.inc.with.atom">rss<em>parse.inc.with.atom</em></a>, rename it rssparser.inc, and it should be a drop in replacement for your current rss_parser.inc. All the documentation at the beginning of the file is all of out of date, but the inline comments have been updated, and you have this blog entry. (as an alternative, you might want to look at using Aaron’s <a href="http://aaronland.info/weblog/2004/01/23/5373/">Atom to RSS stylesheets</a>.)</p>

<h3 id="caveat">Caveat</h3>

<p>I tested against only two Atom feeds, <a href="http://saladwithsteve.com/">Steve’s</a> which I took to be representative of Blogger’s output, and <a href="http://diveintomark.org/xml/atom.xml">Mark’s</a> which I assume is an example of best practices per Atom 0.3. There was a enough variation between them that I don’t feel it was a horrible sampling. Also I only tested against an RSS 1.0 feed to make sure that RSS parsing hadn’t broken, but again, I’m feeling pretty good about it. ### Next Steps</p>

<p>The code is still kind of hoary, and in need of a major refactoring. Also I’m not sure how happy I am with this whole solution, it is partially a proof of concept. So if your interested in parsing parsing Atom with PHP, or have thoughts on Magpie and Atom, take it for a spin, give me some feedback, and we’ll see where it goes.</p>

<h3 id="thoughts-on-atom">Thoughts on Atom</h3>

<p>I’m still not as excited about Atom as I am about RSS. It feels like a dead end format designed for one, and one thing only, blogs. I guess its a good idea to do one thing, and do it well, but I’m not sure I would have chosen blogs as my one thing to do well in life. Also little things like in channel the summary field is called tagline is just annoying, and reminescinent of some of RSS’s worse descision. The various modes, and types of fields make it hard to write a parser which is “correct” (as opposed to us writing <acronym title="Really Stupid Support for Atom">RSAS</acronym> parsers)</p>

<p><strong>update:</strong> Magpierss-0.6a (alpha) is <a href="http://sourceforge.net/project/showfiles.php?group_id=55691">available for download</a>. This release adds the above support for Atom, as well as the <a href="http://laughingmeme.org/archives/001644.html">support borken webservers</a> patch. This is <strong>not</strong> the fabled 0.6 release that was going to be a total rewrite of the parser for better namespace support, that is still vapor.</p>

<p><strong>udpate:</strong> <a href="http://laughingmeme.org/archives/001973.html">MagpieRSS 0.61 (not alpha)</a> is out with Atom support.</p>

  </div><a class="u-url" href="/2004/01/24/experimental-magpie-support-for-atom/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">


    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Kellan Elliott-McCrea</li><li><a class="u-email" href="mailto:kellan@gmail.com">kellan@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list">
  <li>On Mastodon: <a href="https://fiasco.social/@kellan">@kellan</a></li><li><a href="https://www.twitter.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.flickr.com/photos/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#flickr"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://github.com/kellan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">kellan</span></a></li><li><a href="https://www.linkedin.com/in/kellanem"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">kellanem</span></a></li><li><a href="https://kellanem.com/notes/">Leadership blog</a></li>
</ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A personal blog of Kellan Elliott-McCrea. I don&#39;t really know what a &quot;laughing meme&quot; is. It sounded cool in 1999.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
